# ADR-002: 배치 시스템 설계

## 상태

Accepted

## 일자

2025-02-06

## 컨텍스트

사용자 채점 시 실시간으로 전체 통계와 순위를 계산하면 DB 부하가 심각해집니다.
특히 다음 작업이 부하를 유발합니다:
- 전체 응시자 합계/평균 산출
- 순위 계산 (전체/지역별/유형별)
- 점수 분포도 생성

## 결정

**실시간 처리와 배치 처리를 분리**합니다.

### 실시간 처리 (사용자 요청 시)
1. 답안 저장 → USER_ANSWER
2. 즉시 채점 (메모리 내 정답 비교)
3. 개인 점수 저장 → USER_SCORE
4. **임시 순위** 표시 (마지막 배치 결과 기준)

### 배치 처리 (주기적)
| 주기 | 작업 |
|------|------|
| 10분 | 신규 채점 결과 통계 반영 |
| 1시간 | 전체 순위 재계산 |
| 매일 03:00 | 전체 통계 재생성 |

**배치 플래그:**
- `USER_SCORE.BATCH_YN = 'N'`: 배치 미처리
- `USER_SCORE.BATCH_YN = 'Y'`: 배치 완료

## 고려한 대안

### 옵션 1: 완전 실시간 처리
- 장점: 즉시 정확한 순위 표시
- 단점: DB 부하 심각, 응답 지연

### 옵션 2: 배치 전용 처리
- 장점: DB 부하 최소화
- 단점: 순위 반영 지연, 사용자 경험 저하

### 옵션 3: 하이브리드 (선택)
- 장점: 적절한 사용자 경험, DB 부하 분산
- 단점: 순위가 100% 실시간이 아님 (허용 가능)

## 결과

**긍정적 결과:**
- DB 부하 대폭 감소
- 채점 응답 시간 단축
- 시스템 안정성 향상

**부정적 결과/트레이드오프:**
- 순위가 최대 10분 지연될 수 있음
- "순위는 약 10분마다 갱신됩니다" 안내 필요

## 관련 문서

- [ADR-001: 시스템 아키텍처](001-system-architecture.md)
- [IMPLEMENTATION_PROPOSAL.md](../IMPLEMENTATION_PROPOSAL.md)
